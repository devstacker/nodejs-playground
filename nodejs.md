

# Node.js

- **javascript runtime**
- 자바스크립트를 웹브라우저 외부 환경에서도 돌릴수 있게 해주는 환경을 제공해주는 녀석

> runtime은 컴퓨터 프로그램이 실행되고 있는 동안의 동작을 의미. 런타임 환경은 컴퓨터가 실행되는 동안 프로세스나 프로그램을 위한 스프트웨어 서비스를 제공하는 가상 머신의 상태

**cf. REPL (read,evaluate,print,loop)**



### 서버로서의 역할

- 이벤트 기반
- 논 블로킹 I/O 
- 싱글 쓰레드



#### 이벤트기반(Event Driven)

이벤트 기반을 설명하기전에 이벤트 루프를 먼저 알아야 한다(자바스크립트)

**이벤트 루프**는 테스크큐의 작업을 호출스택이 비워지면 호출스택으로 옮겨주는 역할을 한다. 

언제 태스크 큐에 들어갈까?

`setTimeout`, `setInterval`, `setImmediate`, `Promise`, `resolve`, `reject`, `async`, `await`, `이벤트리스너의 콜백` 등의 함수들이 들어간다.

##### 이벤트 루프의 역할

여러개의 태스크 큐에 이런 함수들이 쌓이게 되는데 이벤트 루프의 역할은 여러 큐에서 정해진 순서대로 하나씩 꺼내오는것. (이벤트 루프가 우선순위를 알고 있음)

우선순위가 높은애들을 호출스택으로 꺼내온다.

https://nodejs.org/ko/docs/guides/event-loop-timers-and-nexttick/



이제 이벤트 기반을 알아보자

어떻게 노드가 서버의 역할을 할 수 있을까?

어떻게해야 서버가 동작할 수 있을까?

홈페이지의 경우 방문자에게 html/css/js 파일을 보여줘야하는데 이럴때 이벤트 리스너를 사용해서 사용자가 방문했을 경우 html를 띄우게 한다.

그래서 이벤트 리스너가 작동을 하면서 (HTML줘 - 보통 이런것들을 이벤트리스터에 달린 콜백함수라 부름, 무조건 콜백함수라고해서 태스크 큐로 들어가는것은 아니라고함) 태스크 큐에 콜백함수들이 들어가고 이때 이벤트 루프가 우선순위를 파악해서 호출스택으로 이동시켜 함수들은 호출스택에서 실행이 된다.

이런 흐름을 이벤트 드리븐이라고 한다.

#### 논 블로킹 I/O

논블로킹은 setTimeout처럼 호출스택에 쌓이는것이 아닌 태스크큐로 보내버리는 동작을 뜻함. 그래서 눈에 보이는 코드의 순서와 달리 태스크큐로 보내 <u>실행순서가 달라지는것</u>을 말한다.



> IO(Input/Output) : 파일시스템과 네트워크에서 파일열고쓰고 네트워크 요청 보내고 받고를 의미. 파일시스템은 알아서 멀티쓰레드로 돌림. 자바스크립트는 싱글쓰레드이다. 그래서 노드가 싱글쓰레드인데 이 점을 극복하기 위해 여러프로세스를 만들어 멀티스레드 인것처럼 사용한다고 한다.

